<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hospital Post</title>
<style>
  body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
  label, input, button { display: block; width: 100%; margin: 10px 0; }
  button { background: #4caf50; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; }
  button:disabled { background: gray; cursor: not-allowed; }
  #status { color: green; margin-bottom: 15px; }
</style>
</head>
<body>

<h2>Hospital Post Form</h2>
<div id="status"></div>

<form id="hospitalForm">
  <label>Hospital Name</label>
  <input type="text" id="name" required />

  <label>Area / Location</label>
  <input type="text" id="area" required />

  <label>WhatsApp Number (with country code, e.g. +919876543210)</label>
  <input type="text" id="whatsapp" required />

  <label>Upload Image</label>
  <input type="file" id="image" accept="image/*" required />

  <button type="submit">Post Hospital</button>
</form>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase config अपने प्रोजेक्ट के अनुसार भरें
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const form = document.getElementById('hospitalForm');
  const statusDiv = document.getElementById('status');

  // Imgur Client ID डालें
  const IMGUR_CLIENT_ID = 'YOUR_IMGUR_CLIENT_ID';

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const area = document.getElementById('area').value.trim();
    const whatsapp = document.getElementById('whatsapp').value.trim();
    const imageFile = document.getElementById('image').files[0];

    if(!imageFile) {
      alert('Please select an image.');
      return;
    }

    statusDiv.textContent = 'Uploading image... Please wait.';

    // Imgur में इमेज अपलोड करें
    const formData = new FormData();
    formData.append('image', imageFile);

    try {
      const response = await fetch('https://api.imgur.com/3/image', {
        method: 'POST',
        headers: { Authorization: 'Client-ID ' + IMGUR_CLIENT_ID },
        body: formData
      });
      const data = await response.json();
      if(data.success) {
        const imageUrl = data.data.link;
        statusDiv.textContent = 'Image uploaded successfully! Saving data...';

        // Firebase में पोस्ट करें approved:false के साथ
        const newHospitalRef = db.ref('hospitals').push();
        await newHospitalRef.set({
          name,
          area,
          whatsapp,
          imageUrl,
          approved: false,
          createdAt: Date.now()
        });

        // Admin को WhatsApp नोटिफिकेशन (WhatsApp Web लिंक खुले)
        const adminWhatsAppNumber = '917378342192';
        const message = encodeURIComponent(`नया हॉस्पिटल पोस्ट किया गया है:\nName: ${name}\nArea: ${area}\nWhatsApp: ${whatsapp}\nकृपया जांचें और अप्रूव करें।`);
        window.open(`https://wa.me/${adminWhatsAppNumber}?text=${message}`, '_blank');

        alert('Hospital posted successfully! Waiting for admin approval.');
        form.reset();
        statusDiv.textContent = '';
      } else {
        statusDiv.textContent = 'Image upload failed. Try again.';
      }
    } catch(error) {
      console.error(error);
      statusDiv.textContent = 'Error uploading image.';
    }
  });
</script>

</body>
</html>
