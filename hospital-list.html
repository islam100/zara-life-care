<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hospital Gallery (Firebase)</title>
<style>
  body { font-family: Arial; max-width: 700px; margin: auto; padding: 10px; }
  #areaSelect {
    width: 100%;
    padding: 8px;
    margin-bottom: 15px;
    font-size: 1em;
    box-sizing: border-box;
    border-radius: 8px;
    border: 1px solid #ccc;
    cursor: pointer;
  }

  /* नया Hospital Post button */
  #postHospitalBtn {
    position: fixed;
    top: 10px;
    left: 10px;
    background: #2196F3;
    color: white;
    border: none;
    padding: 6px 14px;
    border-radius: 12px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 5px 8px rgba(33,150,243,0.4);
    transition: box-shadow 0.3s ease;
    z-index: 10000;
    user-select: none;
  }
  #postHospitalBtn:hover {
    box-shadow: 0 8px 15px rgba(33,150,243,0.7);
  }

  #refreshBtn {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #4caf50;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 12px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 5px 8px rgba(76,175,80,0.4);
    transition: box-shadow 0.3s ease;
    user-select: none;
  }
  #refreshBtn:hover {
    box-shadow: 0 8px 15px rgba(76,175,80,0.7);
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(150px,1fr));
    gap: 15px;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.16);
    cursor: pointer;
    text-align: center;
    user-select: none;
    transition: transform 0.2s ease;
  }
  .card:hover {
    transform: translateY(-5px);
  }
  .card img {
    width: 100%;
    border-radius: 8px;
    max-height: 120px;
    object-fit: cover;
  }
  .card h4 {
    margin: 8px 0 5px;
    font-size: 1em;
  }
  .whatsapp-btn {
    background: #25D366;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    font-size: 0.9em;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left:0; top:0; right:0; bottom:0;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
    overflow: auto;
    padding: 10px;
  }
  .modal-content {
    position: relative;
    max-width: 95vw;
    max-height: 90vh;
    border-radius: 10px;
    overflow: hidden;
  }
  .modal-content img {
    display: block;
    width: auto;
    max-width: 100%;
    height: auto;
    max-height: 90vh;
    margin: 0 auto;
  }
  .modal-close {
    position: absolute;
    top: -10px;
    right: -10px;
    background: red;
    color: white;
    font-weight: bold;
    border-radius: 50%;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 20px;
    line-height: 20px;
    user-select: none;
  }

  @media(max-width: 480px) {
    .card img {
      max-height: 100px;
    }
    .modal-content {
      max-width: 95vw;
      max-height: 85vh;
    }
    .modal-content img {
      max-height: 85vh;
    }
  }
</style>
</head>
<body>

<h2>Hospital Gallery</h2>

<select id="areaSelect">
  <option value="">-- Select Area --</option>
</select>

<div class="grid" id="hospitalGrid"></div>

<button id="postHospitalBtn" title="Post a Hospital">Hospital Post</button>
<button id="refreshBtn" title="Reload hospitals">Reload</button>

<!-- Modal -->
<div class="modal" id="imageModal" role="dialog" aria-modal="true" tabindex="-1">
  <div class="modal-content">
    <button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
    <img id="modalImg" src="" alt="Large View" />
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase config (अपना config डालें)
  const firebaseConfig = {
    apiKey: "AIzaSyCFgRQxK_W2T9S5QWZnxAd-kYV52Kzyb94",
    authDomain: "zara-life-care.firebaseapp.com",
    databaseURL: "https://zara-life-care-default-rtdb.firebaseio.com",
    projectId: "zara-life-care",
    storageBucket: "zara-life-care.appspot.com",
    messagingSenderId: "307306937129",
    appId: "1:307306937129:web:a949207fe64fe87dd3d538"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const hospitalGrid = document.getElementById('hospitalGrid');
  const areaSelect = document.getElementById('areaSelect');
  const imageModal = document.getElementById('imageModal');
  const modalClose = document.getElementById('modalClose');
  const modalImg = document.getElementById('modalImg');
  const refreshBtn = document.getElementById('refreshBtn');
  const postHospitalBtn = document.getElementById('postHospitalBtn');

  let hospitals = [];

  function loadHospitals() {
    hospitalGrid.innerHTML = '<p>Loading hospitals...</p>';
    db.ref('hospitals').orderByChild('approved').equalTo(true).once('value')
      .then(snapshot => {
        hospitals = [];
        snapshot.forEach(childSnap => {
          const hospital = childSnap.val();
          hospital.id = childSnap.key;
          hospitals.push(hospital);
        });
        populateAreaDropdown();
        renderHospitals();
      })
      .catch(err => {
        hospitalGrid.innerHTML = `<p>Error loading hospitals: ${err.message}</p>`;
      });
  }

  function populateAreaDropdown() {
    const areas = [...new Set(hospitals.map(h => h.area.trim()).filter(a => a))].sort();
    areaSelect.innerHTML = '<option value="">-- Select Area --</option>';
    areas.forEach(area => {
      const opt = document.createElement('option');
      opt.value = area;
      opt.textContent = area;
      areaSelect.appendChild(opt);
    });
  }

  function renderHospitals() {
    const selectedArea = areaSelect.value;
    hospitalGrid.innerHTML = '';
    let filtered = hospitals;
    if(selectedArea) {
      filtered = hospitals.filter(h => h.area.toLowerCase() === selectedArea.toLowerCase());
    }
    if(filtered.length === 0){
      hospitalGrid.innerHTML = '<p>No hospitals found for this area.</p>';
      return;
    }
    filtered.forEach(hospital => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${hospital.imageUrl}" alt="${hospital.name}" />
        <h4>${hospital.name}</h4>
        <button class="whatsapp-btn" onclick="event.stopPropagation(); window.open('https://wa.me/${hospital.whatsapp.replace(/[^0-9]/g,'')}')">WhatsApp</button>
      `;
      card.addEventListener('click', () => {
        modalImg.src = hospital.imageUrl;
        imageModal.style.display = 'flex';
        imageModal.focus();
      });
      hospitalGrid.appendChild(card);
    });
  }

  modalClose.onclick = () => {
    imageModal.style.display = 'none';
    modalImg.src = '';
  };
  imageModal.onclick = (e) => {
    if(e.target === imageModal) {
      modalClose.onclick();
    }
  };
  document.addEventListener('keydown', (e) => {
    if(e.key === "Escape" && imageModal.style.display === 'flex') {
      modalClose.onclick();
    }
  });

  areaSelect.addEventListener('change', renderHospitals);
  refreshBtn.addEventListener('click', loadHospitals);

  postHospitalBtn.addEventListener('click', () => {
    // अपना hospital post page URL यहां डालें
    window.location.href = 'https://zara-life-care.vercel.app/add-hospital.html';
  });

  loadHospitals();
</script>

</body>
</html>
