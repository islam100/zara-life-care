<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zara Life Care - Ambulance Booking</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin:0; padding:0;
    background: #f0f0f0;
  }
  header {
    background: #004080;
    color: white;
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 { margin:0; font-size: 1.5rem; }
  header button {
    background: #0080ff;
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0, 123, 255, 0.5);
  }
  main {
    max-width: 600px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  #bookingForm {
    display: none;
    margin-top: 15px;
  }
  #bookingForm input, #bookingForm select, #bookingForm textarea {
    width: 100%;
    padding: 8px 10px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  #bookingForm button {
    background: #28a745;
    color: white;
    border: none;
    padding: 10px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(40,167,69,0.5);
  }
  #bookingForm button:hover {
    box-shadow: 0 6px 12px rgba(40,167,69,0.8);
  }
  #statusMessage {
    margin-top: 15px;
    font-weight: bold;
    color: #555;
  }
  #driverInfo {
    margin-top: 20px;
    padding: 15px;
    background: #d9f7d9;
    border-radius: 10px;
    box-shadow: 0 0 10px #28a745;
  }
  #driverInfo h2 {
    margin-top: 0;
  }
  #driverInfo a {
    color: #007bff;
    font-weight: bold;
    text-decoration: none;
  }
  #driverInfo a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>

<header>
  <h1>Zara Life Care</h1>
  <div>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<main>
  <button id="bookAmbBtn">Book Ambulance</button>

  <form id="bookingForm">
    <h2>Ambulance Booking Form</h2>
    <input type="text" id="patientName" placeholder="Patient Name" required />
    <textarea id="patientAddress" placeholder="Patient Address" rows="2" required></textarea>
    <input type="text" id="destination" placeholder="Destination" required />
    <select id="ambulanceCategory" required>
      <option value="" disabled selected>Select Ambulance Category</option>
      <option value="Basic">Basic</option>
      <option value="AC">AC</option>
      <option value="ICU">ICU</option>
      <option value="ALS">ALS (Advanced Life Support)</option>
    </select>
    <input type="tel" id="whatsappNumber" placeholder="WhatsApp Number" pattern="[0-9]{10,15}" required />
    <button type="submit">Submit Booking</button>
  </form>

  <div id="statusMessage"></div>

  <div id="driverInfo" style="display:none;">
    <h2>Ambulance Assigned</h2>
    <p><strong>Driver Name:</strong> <span id="driverName"></span></p>
    <p><strong>Ambulance Category:</strong> <span id="driverAmbCategory"></span></p>
    <p><strong>Ambulance Number:</strong> <span id="driverAmbNo"></span></p>
    <p><strong>Driver WhatsApp:</strong> <a href="#" target="_blank" id="driverWhatsappLink"></a></p>
  </div>
</main>

<!-- Firebase Namespaced SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCFgRQxK_W2T9S5QWZnxAd-kYV52Kzyb94",
    authDomain: "zara-life-care.firebaseapp.com",
    databaseURL: "https://zara-life-care-default-rtdb.firebaseio.com",
    projectId: "zara-life-care",
    storageBucket: "zara-life-care.appspot.com",
    messagingSenderId: "307306937129",
    appId: "1:307306937129:web:a949207fe87dd3d538"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const bookAmbBtn = document.getElementById('bookAmbBtn');
  const bookingForm = document.getElementById('bookingForm');
  const statusMessage = document.getElementById('statusMessage');
  const driverInfoDiv = document.getElementById('driverInfo');

  // Driver info elements
  const driverNameSpan = document.getElementById('driverName');
  const driverAmbCategorySpan = document.getElementById('driverAmbCategory');
  const driverAmbNoSpan = document.getElementById('driverAmbNo');
  const driverWhatsappLink = document.getElementById('driverWhatsappLink');

  // Show form on button click
  bookAmbBtn.addEventListener('click', () => {
    bookingForm.style.display = 'block';
    statusMessage.textContent = '';
    driverInfoDiv.style.display = 'none';
  });

  // Login with Google
  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(err => alert('Login failed: ' + err.message));
  };

  // Logout
  logoutBtn.onclick = () => {
    auth.signOut();
  };

  // Auth state change
  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      bookAmbBtn.disabled = false;
      checkUserBooking(user.uid);
    } else {
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
      bookAmbBtn.disabled = true;
      bookingForm.style.display = 'none';
      statusMessage.textContent = 'Please login to book ambulance.';
      driverInfoDiv.style.display = 'none';
    }
  });

  // Submit booking form
  bookingForm.addEventListener('submit', e => {
    e.preventDefault();
    const user = auth.currentUser;
    if(!user){
      alert('Please login first!');
      return;
    }
    const patientName = document.getElementById('patientName').value.trim();
    const patientAddress = document.getElementById('patientAddress').value.trim();
    const destination = document.getElementById('destination').value.trim();
    const ambulanceCategory = document.getElementById('ambulanceCategory').value;
    const whatsappNumber = document.getElementById('whatsappNumber').value.trim();

    if(!patientName || !patientAddress || !destination || !ambulanceCategory || !whatsappNumber){
      alert('Please fill all fields!');
      return;
    }

    const newBookingKey = db.ref().child('bookings').push().key;
    const bookingData = {
      userId: user.uid,
      patientName,
      patientAddress,
      destination,
      ambulanceCategory,
      whatsappNumber,
      status: 'pending',
      timestamp: Date.now()
    };

    // Save booking
    const updates = {};
    updates['/bookings/' + newBookingKey] = bookingData;

    // Notify all approved drivers
    db.ref('drivers').order
