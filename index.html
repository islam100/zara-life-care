<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zara Life Care - Ambulance Booking</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f4f8;
  }
  header {
    background-color: #004080;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  header h1 {
    margin: 0;
    font-size: 1.8rem;
  }

  /* 3D BUTTON STYLE */
  button {
    cursor: pointer;
    font-weight: bold;
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    background: linear-gradient(145deg, #1e90ff, #0066cc);
    box-shadow: 5px 5px 10px #004080, -5px -5px 10px #3388ff;
    color: white;
    transition: all 0.2s ease;
    user-select: none;
  }
  button:hover {
    background: linear-gradient(145deg, #3ea0ff, #3388ff);
    box-shadow: 2px 2px 5px #004080, -2px -2px 5px #66b2ff;
  }
  button:active {
    box-shadow: inset 3px 3px 5px #004080, inset -3px -3px 5px #3388ff;
  }
  button:focus {
    outline: none;
  }

  main {
    max-width: 600px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 3px 5px 15px rgba(0,0,0,0.1);
  }
  #bookAmbBtn {
    display: block;
    margin: 0 auto 20px auto;
  }
  #bookingForm {
    display: none;
  }
  #bookingForm input, #bookingForm select, #bookingForm textarea {
    width: 100%;
    padding: 8px 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 1rem;
  }
  #bookingForm textarea {
    resize: vertical;
  }
  #statusMessage {
    margin-top: 15px;
    font-weight: bold;
    color: #444;
    text-align: center;
  }
  #driverInfo {
    margin-top: 20px;
    background: #dff0d8;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 0 10px #6ab04c;
  }
  #driverInfo a {
    color: #228822;
    font-weight: bold;
    text-decoration: none;
  }
  #driverInfo a:hover {
    text-decoration: underline;
  }

  /* Responsive */
  @media (max-width: 480px) {
    header {
      flex-direction: column;
      gap: 10px;
    }
    main {
      margin: 15px;
      padding: 15px;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Zara Life Care</h1>
  <div>
    <button id="loginBtn">Login with Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<main>
  <button id="bookAmbBtn" disabled>Book Ambulance</button>

  <form id="bookingForm">
    <h2>Ambulance Booking Form</h2>
    <input type="text" id="patientName" placeholder="Patient Name" required />
    <textarea id="patientAddress" placeholder="Patient Address" rows="3" required></textarea>
    <input type="text" id="destination" placeholder="Destination" required />
    <select id="ambulanceCategory" required>
      <option value="" disabled selected>Select Ambulance Category</option>
      <option value="Basic">Basic</option>
      <option value="AC">AC</option>
      <option value="ICU">ICU</option>
      <option value="ALS">ALS (Advanced Life Support)</option>
    </select>
    <input type="tel" id="whatsappNumber" placeholder="WhatsApp Number" pattern="[0-9]{10,15}" required />
    <button type="submit">Submit Booking</button>
  </form>

  <div id="statusMessage"></div>

  <div id="driverInfo" style="display:none;">
    <h2>Ambulance Assigned</h2>
    <p><strong>Driver Name:</strong> <span id="driverName"></span></p>
    <p><strong>Ambulance Category:</strong> <span id="driverAmbCategory"></span></p>
    <p><strong>Ambulance Number:</strong> <span id="driverAmbNo"></span></p>
    <p><strong>Driver WhatsApp:</strong> <a href="#" target="_blank" id="driverWhatsappLink"></a></p>
  </div>
</main>

<!-- Firebase Libraries v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCFgRQxK_W2T9S5QWZnxAd-kYV52Kzyb94",
    authDomain: "zara-life-care.firebaseapp.com",
    databaseURL: "https://zara-life-care-default-rtdb.firebaseio.com",
    projectId: "zara-life-care",
    storageBucket: "zara-life-care.appspot.com",
    messagingSenderId: "307306937129",
    appId: "1:307306937129:web:a949207fe87dd3d538"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.database();

  // DOM Elements
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const bookAmbBtn = document.getElementById('bookAmbBtn');
  const bookingForm = document.getElementById('bookingForm');
  const statusMessage = document.getElementById('statusMessage');
  const driverInfoDiv = document.getElementById('driverInfo');

  // Driver info fields
  const driverNameSpan = document.getElementById('driverName');
  const driverAmbCategorySpan = document.getElementById('driverAmbCategory');
  const driverAmbNoSpan = document.getElementById('driverAmbNo');
  const driverWhatsappLink = document.getElementById('driverWhatsappLink');

  // Show/hide form on button click
  bookAmbBtn.addEventListener('click', () => {
    bookingForm.style.display = 'block';
    statusMessage.textContent = '';
    driverInfoDiv.style.display = 'none';
  });

  // Login handler
  loginBtn.addEventListener('click', () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .catch(error => alert("Login failed: " + error.message));
  });

  // Logout handler
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Auth state listener
  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      bookAmbBtn.disabled = false;
      checkUserBooking(user.uid);
    } else {
      loginBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'none';
      bookAmbBtn.disabled = true;
      bookingForm.style.display = 'none';
      statusMessage.textContent = 'Please login to book ambulance.';
      driverInfoDiv.style.display = 'none';
    }
  });

  // Submit booking
  bookingForm.addEventListener('submit', e => {
    e.preventDefault();
    const user = auth.currentUser;
    if (!user) {
      alert('Please login first!');
      return;
    }

    // Get form data
    const patientName = document.getElementById('patientName').value.trim();
    const patientAddress = document.getElementById('patientAddress').value.trim();
    const destination = document.getElementById('destination').value.trim();
    const ambulanceCategory = document.getElementById('ambulanceCategory').value;
    const whatsappNumber = document.getElementById('whatsappNumber').value.trim();

    if (!patientName || !patientAddress || !destination || !ambulanceCategory || !whatsappNumber) {
      alert('Please fill all fields');
      return;
    }

    // Prepare booking data
    const newBookingKey = db.ref().child('bookings').push().key;
    const bookingData = {
      userId: user.uid,
      patientName,
      patientAddress,
      destination,
      ambulanceCategory,
      whatsappNumber,
      status: 'pending',
      timestamp: Date.now()
    };

    // Write booking and notify drivers
    let updates = {};
    updates['/bookings/' + newBookingKey] = bookingData;

    // Notify all approved drivers
    db.ref('drivers').orderByChild('status').equalTo('approved').once('value
