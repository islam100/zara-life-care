<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Zara Life Care</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f5f5f5;
  }
  header {
    background: #007BFF;
    color: white;
    padding: 10px 15px;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #logoutBtn {
    padding: 6px 12px;
    font-size: 0.9em;
    border-radius: 6px;
    border: none;
    background: #ff4444;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    display: none;
  }
  #logoutBtn:hover {
    background: #cc0000;
  }
  main {
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  h1 {
    margin-bottom: 15px;
  }
  .booking-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    padding: 15px;
    margin-bottom: 15px;
  }
  .booking-card p {
    margin: 5px 0;
  }
  .status-pending {
    color: orange;
    font-weight: bold;
  }
  .status-confirmed {
    color: green;
    font-weight: bold;
  }
  button.confirm-btn {
    background: #4caf50;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
  }
  button.confirm-btn:hover {
    background: #388e3c;
  }
  #loginMessage {
    text-align: center;
    margin-top: 50px;
    font-size: 1.2em;
    color: #555;
  }
</style>
</head>
<body>

<header>
  <div>Zara Life Care - Admin Panel</div>
  <button id="logoutBtn">Logout</button>
</header>

<main>
  <div id="loginMessage">Loading...</div>
  <div id="bookingList" style="display:none;"></div>
</main>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  // Firebase config (अपना config यहाँ डालें)
  const firebaseConfig = {
    apiKey: "AIzaSyCFgRQxK_W2T9S5QWZnxAd-kYV52Kzyb94",
    authDomain: "zara-life-care.firebaseapp.com",
    databaseURL: "https://zara-life-care-default-rtdb.firebaseio.com/",
    projectId: "zara-life-care",
    storageBucket: "zara-life-care.appspot.com",
    messagingSenderId: "307306937129",
    appId: "1:307306937129:web:a949207fe64fe87dd3d538"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const logoutBtn = document.getElementById('logoutBtn');
  const bookingList = document.getElementById('bookingList');
  const loginMessage = document.getElementById('loginMessage');

  // Admin email list
  const adminEmails = ['zarasamajiksevasanstha@gmail.com'];

  // Logout handler
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Check auth state
  auth.onAuthStateChanged(user => {
    if(user) {
      if(adminEmails.includes(user.email)) {
        loginMessage.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        bookingList.style.display = 'block';
        loadBookings();
      } else {
        loginMessage.textContent = 'You are not authorized to access this page.';
        logoutBtn.style.display = 'inline-block';
        bookingList.style.display = 'none';
      }
    } else {
      loginMessage.textContent = 'Please login with your Google account.';
      logoutBtn.style.display = 'none';
      bookingList.style.display = 'none';
      // Trigger login
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(error => {
        loginMessage.textContent = 'Login failed: ' + error.message;
      });
    }
  });

  function loadBookings() {
    bookingList.innerHTML = '<p>Loading bookings...</p>';
    db.ref('bookings').on('value', snapshot => {
      const bookings = snapshot.val();
      if(!bookings) {
        bookingList.innerHTML = '<p>No bookings found.</p>';
        return;
      }
      bookingList.innerHTML = ''; // clear previous
      Object.entries(bookings).forEach(([key, booking]) => {
        const card = document.createElement('div');
        card.className = 'booking-card';

        card.innerHTML = `
          <p><strong>Booking ID:</strong> ${key}</p>
          <p><strong>Patient Name:</strong> ${booking.patientName}</p>
          <p><strong>Phone:</strong> ${booking.patientPhone}</p>
          <p><strong>Address:</strong> ${booking.patientAddress}</p>
          <p><strong>Destination:</strong> ${booking.destination}</p>
          <p><strong>Ambulance Category:</strong> ${booking.ambulanceCategory}</p>
          <p><strong>Status:</strong> <span class="status-${booking.status}">${booking.status}</span></p>
          <p><strong>Driver Assigned:</strong> ${booking.driverName ? booking.driverName : 'Not assigned'}</p>
          <button class="confirm-btn" ${booking.status === 'confirmed' ? 'disabled' : ''} data-key="${key}">${booking.status === 'pending' ? 'Confirm Booking' : 'Confirmed'}</button>
        `;

        bookingList.appendChild(card);
      });

      // Add event listeners to confirm buttons
      document.querySelectorAll('.confirm-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const bookingKey = btn.getAttribute('data-key');
          confirmBooking(bookingKey, btn);
        });
      });
    });
  }

  function confirmBooking(key, btn) {
    btn.disabled = true;
    db.ref('bookings/' + key).update({
      status: 'confirmed',
      confirmedBy: auth.currentUser.email,
      confirmedAt: Date.now()
    }).then(() => {
      btn.textContent = 'Confirmed';
      btn.classList.remove('confirm-btn');
      btn.style.backgroundColor = '#777';
    }).catch(err => {
      alert('Error confirming booking: ' + err.message);
      btn.disabled = false;
    });
  }
</script>

</body>
</html>
