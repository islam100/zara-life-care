<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Driver Registration - Join as Driver</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 500px;
    margin: auto;
  }
  input, textarea, select, button {
    width: 100%;
    padding: 8px 10px;
    margin: 8px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 16px;
  }
  button {
    background: linear-gradient(145deg, #4CAF50, #45a049);
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
    box-shadow: 4px 4px 6px #3b863e,
                -4px -4px 6px #5fd862;
    transition: box-shadow 0.2s ease;
  }
  button:hover {
    box-shadow: inset 4px 4px 6px #3b863e,
                inset -4px -4px 6px #5fd862;
  }
  video, img {
    width: 100%;
    border-radius: 8px;
    margin: 10px 0;
  }
  #captureBtn {
    width: auto;
    padding: 10px 20px;
    margin-top: 10px;
    box-shadow: 4px 4px 8px #888, -4px -4px 8px #fff;
    background: #008CBA;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }
  #captureBtn:hover {
    box-shadow: inset 4px 4px 8px #555, inset -4px -4px 8px #aaa;
  }
</style>
</head>
<body>

<h1>Join as Driver</h1>
<form id="driverForm">

  <input type="text" id="name" placeholder="Full Name" required />
  <input type="text" id="ambulanceNo" placeholder="Ambulance No" required />
  <input type="text" id="licenseNo" placeholder="Driving License No" required />
  
  <label>Upload Driving License:</label>
  <input type="file" id="licenseUpload" accept="image/*,application/pdf" required />
  
  <label>Upload RC Book:</label>
  <input type="file" id="rcBookUpload" accept="image/*,application/pdf" required />
  
  <label>Upload Aadhar Front:</label>
  <input type="file" id="aadharFront" accept="image/*,application/pdf" required />
  
  <label>Upload Aadhar Back:</label>
  <input type="file" id="aadharBack" accept="image/*,application/pdf" required />
  
  <label>Upload PAN Card:</label>
  <input type="file" id="panUpload" accept="image/*,application/pdf" required />
  
  <label>WhatsApp Number:</label>
  <input type="tel" id="whatsappNo" placeholder="WhatsApp Number" required pattern="[0-9]{10,15}" />
  
  <label>Live Selfie (Use Camera):</label>
  <video id="video" autoplay playsinline></video>
  <button type="button" id="captureBtn">Capture Selfie</button>
  <img id="selfiePreview" style="display:none;" alt="Selfie Preview" />
  
  <textarea id="address" placeholder="Full Address" rows="3" required></textarea>
  
  <button type="submit">Submit</button>
</form>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCFgRQxK_W2T9S5QWZnxAd-kYV52Kzyb94",
    authDomain: "zara-life-care.firebaseapp.com",
    projectId: "zara-life-care",
    storageBucket: "zara-life-care.appspot.com",
    messagingSenderId: "307306937129",
    appId: "1:307306937129:web:a949207fe64fe87dd3d538"
  };
  firebase.initializeApp(firebaseConfig);

  // Redirect to login if not logged in
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      alert("Please login first.");
      window.location.href = "login.html";
    }
  });

  // Live selfie capture setup
  const video = document.getElementById('video');
  const canvas = document.createElement('canvas');
  canvas.width = 320;
  canvas.height = 240;
  const selfiePreview = document.getElementById('selfiePreview');
  let selfieDataURL = "";

  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => { video.srcObject = stream; })
    .catch(() => { alert('Please allow camera access for selfie capture.'); });

  document.getElementById('captureBtn').addEventListener('click', () => {
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    selfieDataURL = canvas.toDataURL('image/png');
    selfiePreview.src = selfieDataURL;
    selfiePreview.style.display = 'block';
  });

  // On form submit
  document.getElementById('driverForm').addEventListener('submit', e => {
    e.preventDefault();

    const user = firebase.auth().currentUser;
    if (!user) {
      alert('You must be logged in!');
      return;
    }

    // Simple validation: check selfie captured
    if (!selfieDataURL) {
      alert('Please capture your selfie before submitting.');
      return;
    }

    // Collect data
    const data = {
      name: document.getElementById('name').value,
      ambulanceNo: document.getElementById('ambulanceNo').value,
      licenseNo: document.getElementById('licenseNo').value,
      whatsappNo: document.getElementById('whatsappNo').value,
      address: document.getElementById('address').value,
      status: 'pending',
      selfie: selfieDataURL,
      // For files, we are just reading file names here. 
      // To upload files, Firebase Storage is needed - extra code.
      licenseFileName: document.getElementById('licenseUpload').files[0]?.name || "",
      rcBookFileName: document.getElementById('rcBookUpload').files[0]?.name || "",
      aadharFrontFileName: document.getElementById('aadharFront').files[0]?.name || "",
      aadharBackFileName: document.getElementById('aadharBack').files[0]?.name || "",
      panFileName: document.getElementById('panUpload').files[0]?.name || "",
      createdAt: Date.now(),
      userId: user.uid
    };

    // Save to Firebase Realtime Database
    firebase.database().ref('drivers/' + user.uid).set(data)
      .then(() => {
        alert('Form submitted successfully! Please wait for admin approval.');
        document.getElementById('driverForm').reset();
        selfiePreview.style.display = 'none';
        selfieDataURL = "";
      })
      .catch(error => {
        alert('Error submitting form: ' + error.message);
      });
  });
</script>

</body>
</html>
